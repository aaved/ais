# Time Zone
set_timezone() {
    ln -sf /usr/share/zoneinfo/${TIMEZONE} /etc/localtime
    hwclock --systohc
}

# Localization
generate_locales() {
    sed -i '/#en_US.UTF-8/s/^#//g' /etc/locale.gen
    locale-gen
    echo LANG=en_US.UTF-8 > /etc/locale.conf
}

# Network Configuration
network_configuration() {
    echo ${HOSTNAME} > /etc/hostname
    echo -e "127.0.0.1 localhost" >> /etc/hosts
    echo -e "::1       localhost" >> /etc/hosts
    echo -e "127.0.1.1 ${HOSTNAME}.localdomain ${HOSTNAME}" >> /etc/hosts
    systemctl enable NetworkManager
}

# Initramfs
create_initramfs() {
    sed -i '/MODULES=()/s/)$/amdgpu)/g' /etc/mkinitcpio.conf
    mkinitcpio -p linux
}

# Root Password
root_password() {
    echo root:${ROOT_PASSWORD1} | chpasswd --root /mnt
}

# Boot Loader
boot_loader() {
    grub-install --target=i386-pc ${DISK}
    sed -i '/GRUB_DEFAULT=0/s/0$/2/g' /etc/default/grub
    sed -i '/GRUB_TIMEOUT=5/s/5$/20/g' /etc/default/grub
    sed -i '/GRUB_CMDLINE_LINUX=""/s/"$/"\nGRUB_DISABLE_OS_PROBER=false/g' >> /etc/default/grub
    grub-mkconfig -o /boot/grub/grub.cfg
}

# User Permissions
user_permissions() {
    echo "${USERNAME} ALL=(ALL) ALL" >> /etc/sudoers.d/${USERNAME}
}

# Create User Account
create_user() {
    useradd ${USERNAME} -m -g users -G wheel,lp,audio,storage,video,network,power -s /bin/bash
    echo ${USERNAME}:${USER_PASSWORD1} | chpasswd
}

archroot() {
    set_timezone
    generate_locales
    network_configuration
    create_initramfs
    root_password
    boot_loader
    user_permissions
    create_user
}

archroot